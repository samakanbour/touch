<!DOCTYPE HTML>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="shortcut icon" href="img/circle.png">
    <title>TOUCH EVENTS</title>
    <link type="text/css" rel="stylesheet" media="all" href="css/reset.css">
    <link type="text/css" rel="stylesheet" media="all" href="css/style.css">
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="http://d3lp1msu2r81bx.cloudfront.net/kjs/js/lib/kinetic-v5.0.1.min.js"></script>
    <script type="text/javascript" src="js/jquery.finger.js"></script>
</head>

<body onmousedown="return false;">
    <h1>TOUCH EVENTS</h1>
    <div id="container"></div>
    <script>
        function update(activeAnchor) {
            var group = activeAnchor.getParent();

            var topLeft = group.find('.topLeft')[0];
            var topRight = group.find('.topRight')[0];
            var bottomRight = group.find('.bottomRight')[0];
            var bottomLeft = group.find('.bottomLeft')[0];
            var image = group.find('.image')[0];

            var anchorX = activeAnchor.x();
            var anchorY = activeAnchor.y();

            // update anchor positions
            switch (activeAnchor.name()) {
                case 'topLeft':
                    topRight.y(anchorY);
                    bottomLeft.x(anchorX);
                    break;
                case 'topRight':
                    topLeft.y(anchorY);
                    bottomRight.x(anchorX);
                    break;
                case 'bottomRight':
                    bottomLeft.y(anchorY);
                    topRight.x(anchorX);
                    break;
                case 'bottomLeft':
                    bottomRight.y(anchorY);
                    topLeft.x(anchorX);
                    break;
            }

            image.setPosition(topLeft.getPosition());

            var width = topRight.x() - topLeft.x();
            var height = bottomLeft.y() - topLeft.y();
            if (width && height) {
                image.setSize({
                    width: width,
                    height: height
                });
            }
        }

        function loadImages(sources, callback) {
            var images = {};
            var loadedImages = 0;
            var numImages = 0;
            for (var src in sources) {
                numImages++;
            }
            for (var src in sources) {
                images[src] = new Image();
                images[src].onload = function() {
                    if (++loadedImages >= numImages) {
                        callback(images);
                    }
                };
                images[src].src = sources[src];
            }
        }

        function initStage(images) {
            var stage = new Kinetic.Stage({
                container: 'container',
                width: $(document).width(),
                height: $(document).height()
            });
            var group1 = new Kinetic.Group({
                x: 270,
                y: 100,
                draggable: true
            });
            var group2 = new Kinetic.Group({
                x: 100,
                y: 110,
                draggable: true
            });
            var layer = new Kinetic.Layer();
            layer.add(group1);
            layer.add(group2);
            stage.add(layer);

            var img1 = new Kinetic.Image({
                x: 0,
                y: 0,
                image: images[0],
                name: 'image'
            });
            var img2 = new Kinetic.Image({
                x: 0,
                y: 0,
                image: images[1],
                name: 'image'
            });

            group1.add(img1);
            group2.add(img2);

            group1.on('dragstart', function() {
                this.moveToTop();
            });
            group2.on('dragstart', function() {
                this.moveToTop();
            });

            stage.draw();
        }

        var sources = ['./img/pm.png', './img/gm.png'];
        loadImages(sources, initStage);
    </script>

</body>

</html>